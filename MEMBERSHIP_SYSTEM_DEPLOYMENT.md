# ä¼šå‘˜ç³»ç»Ÿéƒ¨ç½²æŒ‡å—

## ðŸŽ¯ åŠŸèƒ½æ¦‚è¿°

æœ¬ä¼šå‘˜ç³»ç»ŸåŒ…å«ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š
- **æ¯æ—¥ç‚¹æ•°é‡ç½®**ï¼šä¼šå‘˜æ¯å¤©åŒ—äº¬æ—¶é—´0ç‚¹è‡ªåŠ¨èŽ·å¾—500ç‚¹æ•°
- **ä¼šå‘˜ç­‰çº§ç®¡ç†**ï¼šFREEã€PREMIUMã€PROä¸‰ä¸ªç­‰çº§
- **ç‚¹æ•°å…‘æ¢ä¼šå‘˜**ï¼šæ”¯æŒç”¨ç‚¹æ•°è´­ä¹°ä¼šå‘˜
- **å…‘æ¢ç ç³»ç»Ÿ**ï¼šæ”¯æŒä¼šå‘˜å¤©æ•°å’Œä¼šå‘˜å¥—é¤å…‘æ¢ç 
- **è‡ªåŠ¨åˆ°æœŸå¤„ç†**ï¼šä¼šå‘˜åˆ°æœŸè‡ªåŠ¨è½¬ä¸ºå…è´¹ç”¨æˆ·

## ðŸ“‹ éƒ¨ç½²æ­¥éª¤

### 1. æ•°æ®åº“å‡çº§

åœ¨ Supabase SQL ç¼–è¾‘å™¨ä¸­ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹SQLè„šæœ¬ï¼š

#### 1.1 åŸºç¡€ä¼šå‘˜ç³»ç»Ÿ
```sql
-- æ‰§è¡Œ membership-system-upgrade.sql
```

#### 1.2 å…‘æ¢ç ç³»ç»Ÿå‡çº§
```sql
-- æ‰§è¡Œ upgrade-redemption-codes.sql
```

### 2. çŽ¯å¢ƒå˜é‡é…ç½®

åœ¨ `.env.local` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹çŽ¯å¢ƒå˜é‡ï¼š

```env
# å®šæ—¶ä»»åŠ¡å®‰å…¨å¯†é’¥
CRON_SECRET_KEY=your-secure-cron-key-here

# ç¡®ä¿å…¶ä»–å¿…éœ€çš„APIå¯†é’¥
COZE_TOKEN=your-coze-token
ZhipuOfficial=your-zhipu-api-key
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-key
```

### 3. Verceléƒ¨ç½²é…ç½®

#### 3.1 æ›´æ–° vercel.json
é¡¹ç›®æ ¹ç›®å½•çš„ `vercel.json` å·²é…ç½®æ¯æ—¥0:00ï¼ˆåŒ—äº¬æ—¶é—´16:00ï¼‰çš„å®šæ—¶ä»»åŠ¡ã€‚

#### 3.2 éƒ¨ç½²åˆ°Vercel
```bash
git add .
git commit -m "æ·»åŠ ä¼šå‘˜ç³»ç»ŸåŠŸèƒ½"
git push origin main
```

### 4. åŠŸèƒ½éªŒè¯

#### 4.1 éªŒè¯æ•°æ®åº“è¡¨ç»“æž„
```sql
-- æ£€æŸ¥æ–°è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸ
SELECT table_name FROM information_schema.tables
WHERE table_schema = 'public'
AND table_name IN ('membership_plans', 'membership_purchases', 'daily_reset_logs', 'membership_redemptions');

-- æ£€æŸ¥ä¼šå‘˜å¥—é¤æ•°æ®
SELECT * FROM membership_plans;

-- æ£€æŸ¥ç”¨æˆ·ç‚¹æ•°è¡¨æ–°å­—æ®µ
SELECT user_id, points, daily_points, is_member, membership_expires_at
FROM user_points LIMIT 5;
```

#### 4.2 éªŒè¯APIæŽ¥å£
```bash
# èŽ·å–ä¼šå‘˜å¥—é¤
curl https://your-domain.com/api/membership/plans

# èŽ·å–ä¼šå‘˜çŠ¶æ€ï¼ˆéœ€è¦å…ˆç™»å½•ï¼‰
curl https://your-domain.com/api/membership/status
```

#### 4.3 éªŒè¯å®šæ—¶ä»»åŠ¡
```bash
# æ‰‹åŠ¨è§¦å‘å®šæ—¶ä»»åŠ¡ï¼ˆéœ€è¦æä¾›CRON_SECRET_KEYï¼‰
curl -X POST https://your-domain.com/api/cron/daily-points-reset \
  -H "Authorization: Bearer your-secure-cron-key-here"
```

## ðŸŽ¨ åŠŸèƒ½ä½¿ç”¨è¯´æ˜Ž

### 1. ç”¨æˆ·ç«¯åŠŸèƒ½

#### 1.1 ä¼šå‘˜ä¸­å¿ƒ
- è®¿é—®è·¯å¾„ï¼š`/membership`
- æŸ¥çœ‹å½“å‰ä¼šå‘˜çŠ¶æ€
- è´­ä¹°ä¼šå‘˜å¥—é¤
- æŸ¥çœ‹ä¼šå‘˜ç‰¹æƒå¯¹æ¯”

#### 1.2 ç”¨æˆ·èœå•
- æ˜¾ç¤ºä¼šå‘˜ç­‰çº§å¾½ç« 
- æ˜¾ç¤ºæ¯æ—¥ç‚¹æ•°çŠ¶æ€
- æ˜¾ç¤ºä¼šå‘˜åˆ°æœŸæ—¶é—´
- è¿›å…¥ä¼šå‘˜ä¸­å¿ƒå…¥å£

#### 1.3 å…‘æ¢ç å…‘æ¢
- æ”¯æŒç‚¹æ•°å…‘æ¢ç 
- æ”¯æŒä¼šå‘˜å¤©æ•°å…‘æ¢ç 
- æ”¯æŒä¼šå‘˜å¥—é¤å…‘æ¢ç 

### 2. ç®¡ç†å‘˜åŠŸèƒ½

#### 2.1 ä¼šå‘˜å¥—é¤ç®¡ç†
- åˆ›å»ºå’Œç®¡ç†ä¼šå‘˜å¥—é¤
- è®¾ç½®ç‚¹æ•°ä»·æ ¼å’Œå¤©æ•°
- å¯ç”¨/ç¦ç”¨å¥—é¤

#### 2.2 å…‘æ¢ç ç®¡ç†
- åˆ›å»ºå¤šç§ç±»åž‹å…‘æ¢ç 
- æŸ¥çœ‹å…‘æ¢è®°å½•
- ç®¡ç†å…‘æ¢ç çŠ¶æ€

#### 2.3 ç³»ç»Ÿç®¡ç†
- æ‰‹åŠ¨é‡ç½®ç”¨æˆ·ç‚¹æ•°
- æŸ¥çœ‹é‡ç½®æ—¥å¿—
- ç›‘æŽ§ç³»ç»Ÿè¿è¡ŒçŠ¶æ€

## âš™ï¸ ç³»ç»Ÿé…ç½®

### ä¼šå‘˜å¥—é¤é…ç½®
- **FREE**ï¼š25ç‚¹æ•°/å¤©
- **PREMIUM**ï¼š500ç‚¹æ•°/å¤©ï¼Œ3000ç‚¹æ•°/30å¤©
- **PRO**ï¼š800ç‚¹æ•°/å¤©ï¼Œ5000ç‚¹æ•°/30å¤©

### å®šæ—¶ä»»åŠ¡é…ç½®
- **æ‰§è¡Œæ—¶é—´**ï¼šæ¯å¤©åŒ—äº¬æ—¶é—´0:00ï¼ˆUTC 16:00ï¼‰
- **ä»»åŠ¡è·¯å¾„**ï¼š`/api/cron/daily-points-reset`
- **å®‰å…¨éªŒè¯**ï¼šéœ€è¦ `CRON_SECRET_KEY` çŽ¯å¢ƒå˜é‡

### å…‘æ¢ç ç±»åž‹
- **POINTS**ï¼šç‚¹æ•°å…‘æ¢ç 
- **MEMBERSHIP_DAYS**ï¼šä¼šå‘˜å¤©æ•°å…‘æ¢ç 
- **MEMBERSHIP**ï¼šä¼šå‘˜å¥—é¤å…‘æ¢ç 

## ðŸ”§ ç»´æŠ¤æ“ä½œ

### 1. æ¯æ—¥é‡ç½®ç›‘æŽ§
```sql
-- æŸ¥çœ‹ä»Šæ—¥é‡ç½®æ—¥å¿—
SELECT * FROM daily_reset_logs
WHERE reset_date = CURRENT_DATE
ORDER BY created_at DESC;

-- æŸ¥çœ‹é‡ç½®ç»Ÿè®¡
SELECT
  plan_type,
  COUNT(*) as user_count,
  AVG(new_points) as avg_points
FROM daily_reset_logs
WHERE reset_date = CURRENT_DATE
GROUP BY plan_type;
```

### 2. ä¼šå‘˜çŠ¶æ€æ£€æŸ¥
```sql
-- æŸ¥çœ‹å³å°†åˆ°æœŸçš„ä¼šå‘˜
SELECT
  u.email,
  mp.plan_type,
  mp.end_date,
  EXTRACT(DAYS FROM (mp.end_date - CURRENT_TIMESTAMP)) as days_remaining
FROM membership_purchases mp
JOIN public.users u ON mp.user_id = u.id
WHERE mp.is_active = true
AND mp.end_date > CURRENT_TIMESTAMP
AND mp.end_date <= CURRENT_TIMESTAMP + INTERVAL '7 days'
ORDER BY mp.end_date;
```

### 3. æ•°æ®å¤‡ä»½
å®šæœŸå¤‡ä»½ä»¥ä¸‹é‡è¦è¡¨ï¼š
- `membership_purchases`
- `daily_reset_logs`
- `membership_redemptions`
- `user_points`

## ðŸš¨ æ³¨æ„äº‹é¡¹

1. **æ—¶åŒºé—®é¢˜**ï¼šå®šæ—¶ä»»åŠ¡ä½¿ç”¨UTCæ—¶é—´ï¼ŒåŒ—äº¬æ—¶é—´éœ€è¦å‡8å°æ—¶
2. **æ•°æ®ä¸€è‡´æ€§**ï¼šä¼šå‘˜çŠ¶æ€å˜æ›´ä¼šç«‹å³è§¦å‘ç‚¹æ•°é‡ç½®
3. **å®‰å…¨è€ƒè™‘**ï¼šå®šæ—¶ä»»åŠ¡æŽ¥å£éœ€è¦CRON_SECRET_KEYéªŒè¯
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šæ‰¹é‡é‡ç½®æ“ä½œå·²ä¼˜åŒ–ï¼Œæ”¯æŒå¤§é‡ç”¨æˆ·
5. **é”™è¯¯å¤„ç†**ï¼šç³»ç»ŸåŒ…å«å®Œå–„çš„é”™è¯¯å¤„ç†å’Œå›žæ»šæœºåˆ¶

## ðŸ†˜ æ•…éšœæŽ’é™¤

### å¸¸è§é—®é¢˜

#### 1. å®šæ—¶ä»»åŠ¡æœªæ‰§è¡Œ
- æ£€æŸ¥ `vercel.json` é…ç½®
- éªŒè¯ `CRON_SECRET_KEY` çŽ¯å¢ƒå˜é‡
- æŸ¥çœ‹ Vercel Functions æ—¥å¿—

#### 2. ä¼šå‘˜çŠ¶æ€ä¸æ­£ç¡®
- æ£€æŸ¥ `membership_purchases` è¡¨æ•°æ®
- éªŒè¯ä¼šå‘˜åˆ°æœŸæ—¶é—´è®¾ç½®
- æ‰‹åŠ¨æ‰§è¡Œé‡ç½®æ“ä½œ

#### 3. å…‘æ¢ç æ— æ³•ä½¿ç”¨
- æ£€æŸ¥å…‘æ¢ç ç±»åž‹é…ç½®
- éªŒè¯å…‘æ¢ç çŠ¶æ€
- ç¡®è®¤ç”¨æˆ·æƒé™

#### 4. ç‚¹æ•°é‡ç½®å¤±è´¥
- æ£€æŸ¥æ•°æ®åº“è¿žæŽ¥
- éªŒè¯å‡½æ•°æƒé™
- æŸ¥çœ‹é”™è¯¯æ—¥å¿—

## ðŸ“ˆ ç›‘æŽ§æŒ‡æ ‡

å»ºè®®ç›‘æŽ§ä»¥ä¸‹æŒ‡æ ‡ï¼š
- æ¯æ—¥é‡ç½®æˆåŠŸçŽ‡
- ä¼šå‘˜è½¬åŒ–çŽ‡
- å…‘æ¢ç ä½¿ç”¨çŽ‡
- ä¼šå‘˜ç»­è´¹çŽ‡
- ç³»ç»Ÿå“åº”æ—¶é—´

---

ðŸŽ‰ ä¼šå‘˜ç³»ç»Ÿéƒ¨ç½²å®Œæˆï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒæ•…éšœæŽ’é™¤éƒ¨åˆ†æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚