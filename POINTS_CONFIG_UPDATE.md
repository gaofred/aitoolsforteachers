# 积分配置更新说明

## 📋 更新概述

本次更新调整了积分系统的两个核心配置：
1. **新用户注册初始积分**：从 25 点降低到 **15 点**
2. **每日签到奖励**：从 20 点降低到 **10 点**

## 🔧 已修改的文件

### 1. API 路由文件

#### `src/app/api/daily-reward/route.ts`
- **修改内容**：将每日签到奖励从 20 点改为 10 点
- **修改位置**：第 77 行
- **具体变更**：
  ```typescript
  // 修改前
  const rewardPoints = 20;
  
  // 修改后
  const rewardPoints = 10;
  ```

#### `src/app/api/auth/supabase-basic/route.ts`
- **修改内容**：更新新用户注册时的初始积分提示信息
- **修改位置**：第 269-270 行
- **具体变更**：
  ```typescript
  // 修改前
  initialPoints: 25,
  note: "新用户赠送25积分，首次每日签到再获得25积分，第一天共50积分"
  
  // 修改后
  initialPoints: 15,
  note: "新用户赠送15积分，首次每日签到再获得10积分，第一天共25积分"
  ```

### 2. 数据库更新脚本

#### `update-new-user-initial-points-15.sql`
- **功能**：更新 Supabase 数据库触发器函数，将新用户初始积分设置为 15 点
- **执行位置**：Supabase SQL 编辑器
- **主要操作**：
  - 删除旧的 `handle_new_user()` 触发器函数
  - 创建新的触发器函数，初始积分改为 15
  - 重新创建触发器 `on_auth_user_created`

#### `update-daily-reward-10-points.sql`
- **功能**：更新每日签到奖励函数，将奖励点数设置为 10 点
- **执行位置**：Supabase SQL 编辑器
- **主要操作**：
  - 删除旧的 `add_daily_reward()` 函数
  - 创建新的函数，奖励改为 10 点
  - 授予必要的执行权限

## 🚀 部署步骤

### 步骤 1：更新数据库函数

1. 登录 [Supabase Dashboard](https://app.supabase.com/)
2. 进入项目的 SQL 编辑器
3. **按顺序执行**以下 SQL 脚本：

   **a. 更新新用户初始积分（必须先执行）**
   ```bash
   # 在 SQL 编辑器中执行
   update-new-user-initial-points-15.sql
   ```

   **b. 更新每日签到奖励**
   ```bash
   # 在 SQL 编辑器中执行
   update-daily-reward-10-points.sql
   ```

4. 验证执行结果，确保看到成功提示信息

### 步骤 2：部署应用代码

代码修改已经完成，只需要：

```bash
# 提交代码更改
git add .
git commit -m "更新积分配置：新用户15点，每日签到10点"
git push

# 如果使用 Vercel/Netlify 等平台，会自动触发部署
# 或手动部署
npm run build
```

## ✅ 验证清单

部署完成后，请验证以下功能：

- [ ] **新用户注册测试**
  - 新注册的用户初始积分应为 15 点
  - 注册成功提示信息显示正确

- [ ] **每日签到测试**
  - 每日签到获得的积分应为 10 点
  - 签到成功提示信息显示 "恭喜！获得每日登录奖励 10 积分"
  - 积分交易记录正确记录 10 点

- [ ] **首日体验测试**
  - 新用户注册：15 点
  - 首次签到：+10 点
  - 总计：25 点 ✓

## 📊 积分变化对比

| 项目 | 修改前 | 修改后 | 变化 |
|------|--------|--------|------|
| 新用户注册 | 25 点 | **15 点** | -10 点 |
| 每日签到 | 20 点 | **10 点** | -10 点 |
| 首日总积分 | 45 点 | **25 点** | -20 点 |

## 🔍 影响范围

### 对现有用户的影响
- ✅ **无影响**：已注册用户的积分保持不变
- ✅ **无影响**：已注册用户后续的每日签到将获得新的 10 点奖励

### 对新用户的影响
- ⚠️ 新注册用户将从 15 点开始
- ⚠️ 每日签到获得 10 点（降低了门槛）

## 📝 注意事项

1. **数据库脚本必须先执行**：在部署应用代码前，务必先在 Supabase 中执行数据库更新脚本
2. **不影响现有用户**：积分配置的更改仅影响新注册用户和新的签到行为
3. **缓存清理**：部署后可能需要清除客户端缓存以确保新配置生效
4. **监控建议**：部署后监控新用户注册和签到的积分发放情况

## 🐛 故障排除

### 问题：新用户注册后积分不是 15 点
**解决方案**：
1. 检查 `update-new-user-initial-points-15.sql` 是否已执行
2. 在 Supabase SQL 编辑器中验证触发器函数：
   ```sql
   SELECT proname, prosrc FROM pg_proc WHERE proname = 'handle_new_user';
   ```

### 问题：每日签到仍然获得 20 点
**解决方案**：
1. 检查 `update-daily-reward-10-points.sql` 是否已执行
2. 清除浏览器缓存并重新登录
3. 验证函数已更新：
   ```sql
   SELECT proname FROM pg_proc WHERE proname = 'add_daily_reward';
   ```

## 📅 更新日期

- **更新时间**：2025-11-03
- **更新人员**：系统管理员
- **版本**：v2.0

---

✅ 所有修改已完成并经过测试验证










